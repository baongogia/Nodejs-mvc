<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Danh s√°ch s·∫£n ph·∫©m</title>
    <style>
      table {
        width: 80%;
        margin: 20px auto;
        border-collapse: collapse;
      }

      table,
      th,
      td {
        border: 1px solid #ccc;
      }

      th,
      td {
        padding: 8px;
        text-align: center;
      }

      img {
        max-width: 80px;
        height: auto;
      }
    </style>
  </head>
  <body>
    <div style="text-align: right; margin: 10px 20px">
      <form action="/dashboard/logout" method="POST" style="display: inline">
        <button
          type="submit"
          style="
            background: #e74c3c;
            color: white;
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
          "
        >
          üîÑ Chuy·ªÉn T√†i Kho·∫£n
        </button>
      </form>
    </div>
    <h2 style="text-align: center">Danh s√°ch s·∫£n ph·∫©m</h2>
    <!-- Add products -->
    <div id="crud-actions" style="text-align: right; margin-bottom: 10px">
      <a
        href="/dashboard/dishes/add"
        style="
          padding: 8px 15px;
          background: #2ecc71;
          color: white;
          text-decoration: none;
          border-radius: 5px;
          margin-right: 9.8vw;
          font-size: 16px;
          font-weight: bold;
        "
        >‚ûï Th√™m m√≥n ƒÉn</a
      >
    </div>
    <!-- Table -->
    <table
      border="1"
      width="100%"
      style="border-collapse: collapse; text-align: center"
    >
      <thead>
        <tr>
          <th>H√¨nh ·∫£nh</th>
          <th>T√™n m√≥n ƒÉn</th>
          <th>Gi√°</th>
          <th>M√¥ t·∫£</th>
          <th>B√¨nh lu·∫≠n</th>
          <th>H√†nh ƒë·ªông</th>
        </tr>
      </thead>
      <tbody>
        <% products.forEach(product => { %>
        <tr>
          <td>
            <img
              src="<%= product.image %>"
              alt="H√¨nh s·∫£n ph·∫©m"
              width="80"
              style="border-radius: 5px"
            />
          </td>
          <td><%= product.name %></td>
          <td><%= product.price %> VNƒê</td>
          <td><%= product.description %></td>

          <!-- üü¢ C·ªôt hi·ªÉn th·ªã b√¨nh lu·∫≠n -->
          <td style="text-align: left; padding: 10px; vertical-align: top">
            <% if (product.comments.length > 0) { %>
            <div
              style="max-height: 150px; overflow-y: auto; padding-right: 5px"
            >
              <ul style="list-style: none; padding: 0; margin: 0">
                <% product.comments.forEach(comment => { %>
                <li
                  style="
                    margin-bottom: 10px;
                    padding: 8px;
                    border-radius: 5px;
                    background: #f9f9f9;
                  "
                >
                  <strong style="color: #2c3e50"><%= comment.author %></strong>
                  <span style="font-size: 14px; color: #888"
                    >(‚≠ê <%= comment.rating %>)</span
                  >
                  <p style="margin: 5px 0; color: #333">
                    <%= comment.comment %>
                  </p>

                  <div style="display: flex; justify-content: space-between">
                    <!-- üü¢ N√∫t s·ª≠a b√¨nh lu·∫≠n -->
                    <button
                      onclick="editComment('<%= comment._id %>', '<%= product._id %>', '<%= comment.author %>', '<%= comment.comment %>', '<%= comment.rating %>')"
                      style="
                        background: #3498db;
                        color: white;
                        padding: 3px 8px;
                        border: none;
                        border-radius: 4px;
                        cursor: pointer;
                      "
                    >
                      ‚úèÔ∏è S·ª≠a
                    </button>

                    <!-- üü¢ N√∫t x√≥a b√¨nh lu·∫≠n -->
                    <form
                      action="/dashboard/comments/delete/<%= comment._id %>?dishId=<%= product._id %>"
                      method="POST"
                    >
                      <button
                        type="submit"
                        style="
                          background: #e74c3c;
                          color: white;
                          padding: 3px 8px;
                          border: none;
                          border-radius: 4px;
                          cursor: pointer;
                        "
                      >
                        üóë X√≥a
                      </button>
                    </form>
                  </div>
                </li>
                <% }); %>
              </ul>
            </div>
            <% } else { %>
            <p style="color: #888">Ch∆∞a c√≥ b√¨nh lu·∫≠n</p>
            <% } %>

            <!-- üü¢ Form th√™m b√¨nh lu·∫≠n -->
            <form
              action="/dashboard/comments/add/<%= product._id %>"
              method="POST"
              style="
                margin-top: 10px;
                padding: 10px;
                border-radius: 5px;
                background: #ecf0f1;
              "
            >
              <input
                type="text"
                name="author"
                placeholder="T√™n c·ªßa b·∫°n"
                required
                style="
                  width: 100%;
                  padding: 5px;
                  margin-bottom: 5px;
                  border-radius: 4px;
                  border: 1px solid #ccc;
                "
              />
              <textarea
                name="comment"
                placeholder="Nh·∫≠p b√¨nh lu·∫≠n..."
                required
                style="
                  width: 100%;
                  padding: 5px;
                  margin-bottom: 5px;
                  border-radius: 4px;
                  border: 1px solid #ccc;
                "
              ></textarea>
              <input
                type="number"
                name="rating"
                min="1"
                max="5"
                placeholder="‚≠ê"
                required
                style="
                  width: 100%;
                  padding: 5px;
                  margin-bottom: 5px;
                  border-radius: 4px;
                  border: 1px solid #ccc;
                "
              />
              <button
                type="submit"
                style="
                  background: #2ecc71;
                  color: white;
                  padding: 5px;
                  border-radius: 4px;
                  width: 100%;
                  margin-top: 5px;
                "
              >
                ‚ûï Th√™m B√¨nh Lu·∫≠n
              </button>
            </form>
          </td>

          <td style="width: 15%">
            <a
              href="/dashboard/dishes/edit/<%= product._id %>"
              style="
                padding: 5px 10px;
                background: #3498db;
                color: white;
                text-decoration: none;
                border-radius: 4px;
              "
              >üìù S·ª≠a</a
            >
            <form
              action="/dashboard/dishes/delete/<%= product._id %>"
              method="POST"
              style="display: inline"
            >
              <button
                type="submit"
                style="
                  padding: 5px 10px;
                  background: #e74c3c;
                  color: white;
                  border: none;
                  border-radius: 4px;
                  cursor: pointer;
                "
              >
                üóë Xo√°
              </button>
            </form>
          </td>
        </tr>
        <% }); %>
      </tbody>
    </table>
    <!-- üü¢ Modal ch·ªânh s·ª≠a b√¨nh lu·∫≠n -->
    <div
      id="editCommentModal"
      style="
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        padding: 20px;
        border-radius: 10px;
        border: 1px solid #ccc;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
      "
    >
      <h3 style="margin-bottom: 10px">‚úèÔ∏è Ch·ªânh s·ª≠a b√¨nh lu·∫≠n</h3>
      <form id="editCommentForm" action="" method="POST">
        <input type="hidden" id="editCommentId" name="commentId" />
        <input type="hidden" id="editDishId" name="dishId" />

        <label style="font-weight: bold">T√™n c·ªßa b·∫°n:</label>
        <input
          type="text"
          id="editAuthor"
          name="author"
          required
          style="
            width: 100%;
            padding: 5px;
            margin-bottom: 10px;
            border-radius: 4px;
            border: 1px solid #ccc;
          "
        />

        <label style="font-weight: bold">B√¨nh lu·∫≠n:</label>
        <textarea
          id="editCommentText"
          name="comment"
          required
          style="
            width: 100%;
            padding: 5px;
            margin-bottom: 10px;
            border-radius: 4px;
            border: 1px solid #ccc;
          "
        ></textarea>

        <label style="font-weight: bold">‚≠ê ƒê√°nh gi√°:</label>
        <input
          type="number"
          id="editRating"
          name="rating"
          min="1"
          max="5"
          required
          style="
            width: 100%;
            padding: 5px;
            margin-bottom: 10px;
            border-radius: 4px;
            border: 1px solid #ccc;
          "
        />

        <button
          type="submit"
          style="
            background: #3498db;
            color: white;
            padding: 5px;
            border-radius: 4px;
            width: 100%;
            margin-top: 5px;
          "
        >
          üíæ L∆∞u
        </button>
        <button
          type="button"
          onclick="document.getElementById('editCommentModal').style.display='none'"
          style="
            background: #e74c3c;
            color: white;
            padding: 5px;
            border-radius: 4px;
            width: 100%;
            margin-top: 5px;
          "
        >
          ‚ùå H·ªßy
        </button>
      </form>
    </div>
    <h2 style="text-align: center; margin-top: 40px">Danh s√°ch Category</h2>

    <!-- üü¢ N√∫t th√™m Category -->
    <div style="text-align: right; margin-bottom: 10px">
      <button
        onclick="openAddCategoryModal()"
        style="
          padding: 8px 15px;
          background: #2ecc71;
          color: white;
          text-decoration: none;
          border-radius: 5px;
          font-size: 16px;
          font-weight: bold;
          margin-right: 10vw;
        "
      >
        ‚ûï Th√™m Category
      </button>
    </div>

    <!-- üü¢ Table Category -->
    <table
      border="1"
      width="80%"
      style="border-collapse: collapse; text-align: center; margin: auto"
    >
      <thead>
        <tr>
          <th>T√™n Category</th>
          <th>M√¥ t·∫£</th>
          <!-- üü¢ Th√™m c·ªôt M√¥ t·∫£ -->
          <th>H√†nh ƒë·ªông</th>
        </tr>
      </thead>
      <tbody>
        <% categories.forEach(category => { %>
        <tr>
          <td><%= category.name %></td>
          <td><%= category.description %></td>
          <!-- üü¢ Hi·ªÉn th·ªã m√¥ t·∫£ -->
          <td style="width: 25%">
            <!-- üü¢ N√∫t S·ª≠a -->
            <button
              onclick="editCategory('<%= category._id %>', '<%= category.name %>', '<%= category.description %>')"
              style="
                padding: 5px 10px;
                background: #3498db;
                color: white;
                border: none;
                border-radius: 4px;
                cursor: pointer;
              "
            >
              ‚úèÔ∏è S·ª≠a
            </button>

            <!-- üü¢ Form X√≥a -->
            <form
              action="/dashboard/categories/delete/<%= category._id %>"
              method="POST"
              style="display: inline"
            >
              <button
                type="submit"
                style="
                  padding: 5px 10px;
                  background: #e74c3c;
                  color: white;
                  border: none;
                  border-radius: 4px;
                  cursor: pointer;
                "
              >
                üóë X√≥a
              </button>
            </form>
          </td>
        </tr>
        <% }); %>
      </tbody>
    </table>
    <!-- üü¢ Modal th√™m category -->
    <div
      id="addCategoryModal"
      style="
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        padding: 20px;
        border-radius: 10px;
        border: 1px solid #ccc;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
      "
    >
      <h3>‚ûï Th√™m Category</h3>
      <form action="/dashboard/categories/add" method="POST">
        <label style="font-weight: bold">T√™n Category:</label>
        <input
          type="text"
          name="name"
          required
          style="
            width: 100%;
            padding: 5px;
            margin-bottom: 10px;
            border-radius: 4px;
            border: 1px solid #ccc;
          "
        />

        <label style="font-weight: bold">M√¥ t·∫£:</label>
        <textarea
          name="description"
          required
          style="
            width: 100%;
            padding: 5px;
            margin-bottom: 10px;
            border-radius: 4px;
            border: 1px solid #ccc;
          "
        ></textarea>

        <button
          type="submit"
          style="
            background: #2ecc71;
            color: white;
            padding: 5px;
            border-radius: 4px;
            width: 100%;
            margin-top: 5px;
          "
        >
          ‚ûï Th√™m
        </button>
        <button
          type="button"
          onclick="document.getElementById('addCategoryModal').style.display='none'"
          style="
            background: #e74c3c;
            color: white;
            padding: 5px;
            border-radius: 4px;
            width: 100%;
            margin-top: 5px;
          "
        >
          ‚ùå H·ªßy
        </button>
      </form>
    </div>
    <!-- üü¢ Modal ch·ªânh s·ª≠a category -->
    <div
      id="editCategoryModal"
      style="
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        padding: 20px;
        border: 1px solid #ccc;
        border-radius: 10px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
      "
    >
      <h3>‚úèÔ∏è Ch·ªânh s·ª≠a Category</h3>
      <form id="editCategoryForm" action="" method="POST">
        <input type="hidden" id="editCategoryId" name="categoryId" />

        <label style="font-weight: bold">T√™n Category:</label>
        <input
          type="text"
          id="editCategoryName"
          name="name"
          required
          style="
            width: 100%;
            padding: 5px;
            margin-bottom: 10px;
            border-radius: 4px;
            border: 1px solid #ccc;
          "
        />

        <label style="font-weight: bold">M√¥ t·∫£:</label>
        <textarea
          id="editCategoryDescription"
          name="description"
          required
          style="
            width: 100%;
            padding: 5px;
            margin-bottom: 10px;
            border-radius: 4px;
            border: 1px solid #ccc;
          "
        ></textarea>

        <button
          type="submit"
          style="
            background: #3498db;
            color: white;
            padding: 5px;
            border-radius: 4px;
            width: 100%;
            margin-top: 5px;
          "
        >
          üíæ L∆∞u
        </button>
        <button
          type="button"
          onclick="document.getElementById('editCategoryModal').style.display='none'"
          style="
            background: #e74c3c;
            color: white;
            padding: 5px;
            border-radius: 4px;
            width: 100%;
            margin-top: 5px;
          "
        >
          ‚ùå H·ªßy
        </button>
      </form>
    </div>
  </body>
  <script>
    function editComment(commentId, dishId, author, comment, rating) {
      document.getElementById("editCommentId").value = commentId;
      document.getElementById("editDishId").value = dishId;
      document.getElementById("editAuthor").value = author;
      document.getElementById("editCommentText").value = comment;
      document.getElementById("editRating").value = rating;
      document.getElementById("editCommentForm").action =
        "/dashboard/comments/edit/" + commentId + "?dishId=" + dishId;
      document.getElementById("editCommentModal").style.display = "block";
    }
    function openAddCategoryModal() {
      document.getElementById("addCategoryModal").style.display = "block";
    }

    function editCategory(categoryId, categoryName, categoryDescription) {
      document.getElementById("editCategoryId").value = categoryId;
      document.getElementById("editCategoryName").value = categoryName;
      document.getElementById("editCategoryDescription").value =
        categoryDescription;
      document.getElementById("editCategoryForm").action =
        "/dashboard/categories/edit/" + categoryId;
      document.getElementById("editCategoryModal").style.display = "block";
    }
  </script>
</html>
